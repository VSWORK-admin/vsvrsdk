## Documentation ##

### 1. Purpose
>The project is the VSVR SDK expansion project, which is used to generate the bytecode required by the VSVR interactive SDK.

>When writing VSVR interactive logic, check this project to the local, and write VSVR C# interactive code in this project. It is recommended to use VisualStudio as IDE.

### 2. Use steps
#### 2.1 Entry function
The code starts to execute from the ```Main()``` function of the ```Dll_Project.DllMain``` class, the corresponding c# file is ```/Dll_Project/DllMain.cs```, the entry function will be 2.4. The script configured in 2 performs the initialization operation (enable the gameobject where the script is located), as shown in the example:
```
public static void Main()
{
    UnityEngine.Debug.Log("Dll Run Main !");

    foreach (var obj in DllManager.Instance.ExtralDatas)
    {
        if (obj.Target != null)
        {
            obj.Target.gameObject.SetActive(true);
        }
    }
}
```
#### 2.2 Interactive logic code writing
###### 2.2.1 Create script file
Create a ```*.cs``` file in the same directory as the ```/Dll_Project/DllMain.cs``` file. The file name is the same as the class name, such as ```Click_show_hideDemo``` in the project example (**The location is in the vsvrsdk project/ Assets/Scenes/ILruntime_Example/Click_show_hide_Objs_Dll**)

###### 2.2.2 Inheritance class
The code cannot directly inherit the MonoBehaviour class and must inherit the DllGenerateBase wrapper class as a substitute

#### 2.3 Generate bytecode
###### 2.3.1 Set generation event
In VisualStudio Project ->'Dll_Project' Properties -> Generate Event -> Post-Generation Event Command Line Fill in the absolute path of the project:
```
copy "$(TargetDir)$(ProjectName).dll" "D:\vsvrsdk\Assets\Scenes\ILruntime_Example\$(ProjectName)dll.bytes"
copy "$(TargetDir)$(ProjectName).pdb" "D:\vsvrsdk\Assets\Scenes\ILruntime_Example\$(ProjectName)pdb.bytes"
```

Or create a ```DllProject``` folder in the root directory of the Unity project, place the project in this folder and assign the ```.bytes``` file to a relative directory such as:
```
copy "$(TargetDir)$(ProjectName).dll" "$(SolutionDir)..\..\Assets\Scenes\ILruntime_Example\$(ProjectName)dll.bytes"
copy "$(TargetDir)$(ProjectName).pdb" "$(SolutionDir)..\..\Assets\Scenes\ILruntime_Example\$(ProjectName)pdb.bytes"
```
###### 2.3.1 Generate bytecode
Solution configuration is set to ```Release```

Click Generate -> After generating the solution, two ```.bytes``` files will be created automatically:
```Dll_Projectdll.bytes``` and ```Dll_Projectpdb.bytes```, the two files are the interactive logic bytecode files required by the unity scene.

The generated bytecode file after the event command line is configured to the path of the scene in the Unity project directory will automatically appear in the path of the Unity scene. If you keep the default ```$(ProjectDir)unitybytes```, you need After generation, manually copy the two bytecode files in ``ʻunitybytes``` to the directory where the scene is located in the Unity project.

#### 2.4 Unity project configuration
###### 2.4.1 Configuration loading bytecode
Drag the `DllManager.cs` component into any object in the SDK scene (**There can only be one ``DllManager.cs``` component** in a scene), and then add ```Dll_Projectdll.bytes ```,```Dll_Projectpdb.bytes```Respectively drag into ```DllAsset```,```PdbAsset```
###### 2.4.2 Configure interactive script
Put the ```GeneralDllBehavior`'' component into any object in the SDK scene, and fill in the package class name in ```ScriptClassName`` (if there is a namespace, the name of the namespace must also be included when filling in, such as ```Dll_Project.TestSetLeftHand ```, if the namespace is not included, fill in the class name directly, such as ```Click_show_hideDemo```), this class can be like the MonoBehaviour class of unity.

Drag the object where the ```GeneralDllBehavior``` component is located into the ExtraDatas in the Inspector where the `DllManager``` created in 2.4.1 is located. If there are multiple ```GeneralDllBehavior```, set them in DllManager Multiple ExtraDatas and drag them in order.
###### 2.4.3 Configure interactive script initialization
**Manually set the object where the ```GeneralDllBehavior`'' component is inactive in the Inspector**, in the entry function, the component will be automatically enabled during initialization (```SetActive(true)```) that is Complete initialization.

#### 2.5 Basic usage
###### 2.5.1 Get scene gameobjects in script
Use the ExtralData class, which also exists in other scripts, mainly used to easily obtain references to objects in some scenes without writing some Find code
If you need to operate to set an object to be visible in ```Click_show_hideDemo```, you can drag the object into the ExtraDatas in the ```GeneralDllBehavior``` component where ```Click_show_hideDemo``` is located and use ```BaseMono .ExtralDatas``` to get ```ExtralData[]``` ​​as shown in the code:
```
public List<GameObject> ClickObjs = new List<GameObject>();
public List<GameObject> ShowObjs = new List<GameObject>();

public override void Awake()
{
    ClickObjs.Clear();
    ShowObjs.Clear();

    foreach (var obj in BaseMono.ExtralDatas)
    {
        if (obj.Target != null)
        {
            if (obj.OtherData.Equals("0"))
            {
                ClickObjs.Add(obj.Target.gameObject);
            }
            else if (obj.OtherData.Equals("1"))
            {
                ShowObjs.Add(obj.Target.gameObject);
            }
        }
    }
}
```
###### 2.5.2 Send and receive VR command messages
Add quote ``ʻusing com.ootii.Messages;```


Send VR command information: Use ```MessageDispatcher.SendMessage``` to send information with a string of type ```WsMessageType.SendCChangeObj```
The message body is ```WsCChangeInfo``` class

```
WsCChangeInfo wsinfo1 = new WsCChangeInfo()
{
    a = "showitem",
    b = showItemName,
    c = string.Empty,
    d = string.Empty,
    e = string.Empty,
    f = string.Empty,
    g = string.Empty,
};

MessageDispatcher.SendMessage(this, WsMessageType.SendCChangeObj.ToString(), wsinfo1, 0);
```



Create a method of receiving information
```
void RecieveCChangeObj(IMessage msg)
{
    WsCChangeInfo rinfo = msg.Data as WsCChangeInfo;
    ShowbStr = rinfo.b;
    Debug.LogWarning(ShowbStr);
}
```


Binding and unbinding receive information events:
```
public override void OnEnable()
{
    MessageDispatcher.AddListener(WsMessageType.RecieveCChangeObj.ToString(), RecieveCChangeObj);
}

public override void OnDisable()
{
    MessageDispatcher.RemoveListener(WsMessageType.RecieveCChangeObj.ToString(), RecieveCChangeObj);
}
```
###### 2.5.3 Get VR used objects
There are objects commonly used in VR in the ```mStaticThings``` class, which can be obtained directly with ```mStaticThins.I.xxx``` singleton ,please check ```mStaticThins.I``` is not ```null``` before use it

For example, in the ```Dll_Project.TestSetLeftHand``` example, set a ball to the left-hand handle position in Update and follow:
```
public override void Update()
{
    if (mStaticThings.I != null) {
        BaseMono.ExtralDatas[0].Target.gameObject.transform.position = mStaticThings.I.LeftHand.position;
    }
}
```
###### 2.5.4 Get the object clicked by the VR handle
Listen to the event whose string is "VRPointClick", and the event returns GameObject

```
public override void OnEnable()
{
    MessageDispatcher.AddListener(VRPointObjEventType.VRPointClick.ToString(), GetPointEventType);
}

public override void OnDisable()
{
    MessageDispatcher.RemoveListener(VRPointObjEventType.VRPointClick.ToString(), GetPointEventType);
}

void GetPointEventType(IMessage msg)
{
    GameObject pobj = msg.Data as GameObject;
    ClickedObj = pobj;

    HandleGetPointedObj();
}
```

###### 2.5.5 Get VR handle key Click events
Listen to the event of ``ʻenum CommonVREventType.xxxx.ToString()```

```
public override void OnEnable()
{
    MessageDispatcher.AddListener(CommonVREventType.VRRaw_RightTrigger.ToString(), GetVRInput);
}

public override void OnDisable()
{
    MessageDispatcher.RemoveListener(CommonVREventType.VRRaw_RightTrigger.ToString(), GetVRInput);
}

Vector2 Rcieved2DAxis;
Float Rcieved1DAxis;

void GetVRInput(IMessage msg)
{
    if(msg.Type == CommonVREventType.VR_LefStickAxis.ToString() || msg.Type == CommonVREventType.VR_RightStickAxis.ToString()){
        Rcieved2DAxis.Value = (Vector2)msg.Data;
    }else if(msg.Type == CommonVREventType.VR_LeftTriggerAxis.ToString() || msg.Type == CommonVREventType.VR_RightTriggerAxis.ToString() || msg.Type == CommonVREventType.VR_LeftGrabAxis.ToString() || msg.Type = = CommonVREventType.VR_RightGrabAxis.ToString()){
        Rcieved1DAxis.Value = (float)msg.Data;
    }
}
```
###### 2.5.6 For other events and settings, please refer to the case of playmaker in ``ʻAssets/_VSVRSDK/VRActions``` in the vsvrsdk project to imitate writing C# interaction. The VRActions function is in the README of the vsvrsdk project Detailed introduction